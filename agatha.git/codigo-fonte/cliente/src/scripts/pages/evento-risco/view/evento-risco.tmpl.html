<md-content flex>
    <div class="sgr-container">

        <form name="formRegistro" ng-submit="scope.persistir(scope.registro)" novalidate>

            <div class="sgr-container-body">

                <div>
                    <div layout="row" layout-xs="column" class="processo-info p-b-0">
                        <div class="md-block" flex-gt-xs flex="100">
                            <strong>
                                <sgr-glossario termo="Macroprocesso"></sgr-glossario>
                            </strong>
                        </div>
                    </div>
                    <div layout="row" layout-xs="column" class="processo-info">
                        <div class="md-block" flex-gt-xs flex="100">
                            <span>{{scope.processo.macroprocesso.descricao}}</span>
                        </div>
                    </div>

                    <div layout="row" layout-xs="column" class="processo-info p-b-0">
                        <div class="md-block" flex-gt-xs flex="100">
                            <strong>
                                <sgr-glossario termo="Processo"></sgr-glossario>
                            </strong>
                        </div>
                    </div>
                    <div layout="row" layout-xs="column" class="processo-info">
                        <div class="md-block" flex-gt-xs flex="100">
                            <span>{{scope.processo.processo}}</span>
                        </div>
                    </div>

                    <div layout="row" layout-xs="column" class="processo-info p-b-0">
                        <div class="md-block" flex-gt-xs flex="30">
                            <strong>
                                <sgr-glossario termo="Objetivo do Macroprocesso/Processo"></sgr-glossario>
                            </strong>
                        </div>
                    </div>
                    <div layout="row" layout-xs="column" class="processo-info">
                        <div class="md-block" flex-gt-xs flex="30">
                            <span>{{scope.processo.objetivo}}</span>
                        </div>
                    </div>

                    <hr color="#4CAF50" width="99%" size="2px"/>
                </div>

                <div class="m-t-20 m-l-10" layout="row" layout-xs="column">

                    <!--<md-input-container class="md-block" flex-gt-xs flex="100">-->
                    <!--<label>-->
                    <!--<sgr-glossario termo="Evento de Risco"></sgr-glossario>-->
                    <!--</label>-->
                    <!--<md-autocomplete class="md-autocomplete-icon" id="evento-risco" md-floating-label="" md-no-cache="true" md-search-text-change="scope.getEventoBySearch()" md-search-text="scope.registro.evento.descricao" md-selected-item-change="scope.registro.evento = item"-->
                    <!--md-item-text="scope.registro.evento.descricao" md-items="item in scope._eventos" md-min-length="2" required>-->
                    <!--<md-item-template>-->
                    <!--<span md-highlight-text="scope.registro.evento.descricao" md-highlight-flags="^i">{{item.descricao}}</span>-->
                    <!--</md-item-template>-->
                    <!--</md-autocomplete>-->
                    <!--</md-input-container>-->

                    <!--<md-button class="md-fab md-primary md-hue-2 md-mini" aria-label="Enviar" ng-click="scope.salvarTaxonomiaEvento()">-->
                    <!--<md-tooltip>Enviar para taxonomia</md-tooltip>-->
                    <!--<md-icon style="color:white">send</md-icon>-->
                    <!--</md-button>-->

                    <md-input-container class="md-block" flex-gt-xs flex="100">
                        <label>
                            <sgr-glossario termo="Evento de Risco"></sgr-glossario>
                        </label>
                        <input ng-model="scope.registro.evento.descricao" max="1000" maxlength="1000" type="text" ng-disabled="scope.apenasLeitura" required/>
                    </md-input-container>

                </div>

                <div layout="row" layout-xs="column" class="processo-info p-b-0 p-t-0" ng-show="scope.registro.historico.length">
                    <div class="md-block" flex-gt-xs flex="30">
                        <strong>
                            <sgr-glossario termo="Histórico - Eventos de Risco"></sgr-glossario>
                        </strong>
                    </div>
                </div>
                <div layout="row" layout-xs="column" ng-show="scope.registro.historico.length">
                    <div class="sgr-container-table" layout="column" flex-gt-xs flex="100">
                        <md-card style="max-height: 240px">
                            <md-table-container>
                                <table md-table>
                                    <thead md-head>
                                    <tr md-row>
                                        <th md-column class="text-center" width="30px">
                                            <sgr-glossario termo="Item"></sgr-glossario>
                                        </th>
                                        <th md-column>
                                            <sgr-glossario termo="Evento de Risco"></sgr-glossario>
                                        </th>
                                        <th md-column class="text-center" width="80px">
                                            <sgr-glossario termo="Data da Alteração"></sgr-glossario>
                                        </th>
                                        <th md-column width="20%">
                                            <sgr-glossario termo="Usuário Responsável"></sgr-glossario>
                                        </th>
                                    </tr>
                                    </thead>

                                    <tbody md-body>
                                    <tr md-row ng-repeat="item in scope.registro.historico">
                                        <td md-cell class="text-center" width="30px">
                                            <span>{{$index+1}}</span>
                                        </td>
                                        <td md-cell>
                                            <span>{{item.evento}}</span>
                                        </td>
                                        <td md-cell class="text-center">
                                            <span>{{item.dtCadastro | date:'dd/MM/yyyy'}}</span>
                                        </td>
                                        <td md-cell>
                                            <span>{{item.usuarioNome}}</span>
                                        </td>

                                    </tr>
                                    </tbody>
                                </table>
                            </md-table-container>
                        </md-card>
                    </div>
                </div>

                <div layout="row" layout-xs="column">
                    <h3 style="margin-bottom: 0; padding-left: 7px;">
                        <sgr-glossario termo="Causas"></sgr-glossario>
                    </h3>
                </div>
                <hr color="#4CAF50" width="99%" size="1px"/>

                <div layout="row" layout-xs="column">

                    <md-button class="md-primary" aria-label="Incluir" ng-click="scope.incluirCausaAndFocus()">
                        <md-icon md-font-set="material-icons">add</md-icon>
                        <sgr-glossario termo="Causa"></sgr-glossario>
                    </md-button>

                </div>

                <div class="sgr-container-table" layout="column" flex-gt-xs flex="100">
                    <md-card>
                        <md-table-container>
                            <table md-table>
                                <thead md-head>
                                <tr md-row>
                                    <th md-column class="text-center" width="30px">
                                        <sgr-glossario termo="Item"></sgr-glossario>
                                    </th>
                                    <th md-column>
                                        <sgr-glossario termo="Descrição"></sgr-glossario>
                                    </th>
                                    <th md-column class="text-center" width="150px">
                                        <sgr-glossario termo="Ações"></sgr-glossario>
                                    </th>
                                </tr>
                                </thead>

                                <tbody md-body>
                                <tr md-row ng-show="scope.incluirCausa">
                                    <td md-cell class="text-center">
                                        <span>#</span>
                                    </td>
                                    <td>

                                        <!--<md-input-container class="md-block" flex-gt-xs flex="100">-->
                                        <!--<label>-->
                                        <!--<sgr-glossario termo="Descrição"></sgr-glossario>-->
                                        <!--</label>-->
                                        <!--<md-autocomplete ng-enter="scope.adicionarCausa()" class="md-autocomplete-icon" md-input-id="causa-risco" md-floating-label="" md-no-cache="true" md-search-text-change="scope.getCausasBySearch()" md-search-text="scope.causa.descricao" md-selected-item-change="scope.causa = item" md-item-text="scope.causa.descricao" md-items="item in scope._causas" md-min-length="2">-->
                                        <!--<md-item-template id="incluir-causa">-->
                                        <!--<span md-highlight-text="scope.causa.descricao" md-highlight-flags="^i">{{item.descricao}}</span>-->
                                        <!--</md-item-template>-->
                                        <!--</md-autocomplete>-->
                                        <!--</md-input-container>-->

                                        <md-input-container class="md-block no-margin" flex-gt-xs flex="100">
                                            <input ng-model="scope.causa.descricao" ng-enter="scope.adicionarCausaInline()" max="1000" maxlength="1000" type="text" id="causa-risco"/>
                                        </md-input-container>

                                    </td>

                                    <td width="100" align="center" ng-if="!scope.apenasLeitura">
                                        <md-button ng-click="scope.adicionarCausaInline()" class="md-icon-button" aria-label="Editar" style="margin: 0">
                                            <md-icon class="table-icon">check</md-icon>
                                            <md-tooltip>Incluir Causa do Risco</md-tooltip>
                                        </md-button>
                                        <md-button ng-click="scope.incluirCausa = false; scope.causa = {}" class="md-icon-button" aria-label="Excluir" style="margin: 0">
                                            <md-icon class="table-icon" md-font-set="material-icons">cancel</md-icon>
                                            <md-tooltip>Cancelar</md-tooltip>
                                        </md-button>
                                    </td>
                                </tr>

                                <tr md-row ng-repeat="item in scope.registro.causas | orderBy: 'causa.descricao'">
                                    <td md-cell class="text-center" width="30px">
                                        <span ng-bind="$index + 1"></span>
                                    </td>
                                    <td md-cell>

                                        <span ng-show="!item.$update" ng-bind="item.causa.descricao"></span>

                                        <!--<md-input-container class="md-block" flex="100" ng-show="item.$update ">-->
                                        <!--<md-autocomplete ng-enter="scope.handleCausaChange($event)" class="md-autocomplete-icon" id="causa-risco-editar" md-floating-label="" md-no-cache="true" md-search-text-change="scope.getEditarCausasBySearch()" md-search-text="scope.editarCausa.causa.descricao"-->
                                        <!--md-selected-item-change="scope.editarCausa.causa = item" md-item-text="scope.editarCausa.causa.descricao"-->
                                        <!--md-items="item in scope._causas" md-min-length="2">-->
                                        <!--<md-item-template>-->
                                        <!--<span md-highlight-text="scope.editarCausa.causa.descricao" md-highlight-flags="^i">{{item.descricao}}</span>-->
                                        <!--</md-item-template>-->
                                        <!--</md-autocomplete>-->
                                        <!--</md-input-container>-->

                                        <md-input-container class="md-block no-margin" flex-gt-xs flex="100" ng-show="item.$update">
                                            <input ng-model="scope.editarCausa.causa.descricao" ng-enter="scope.handleCausaChange($event)" max="1000" maxlength="1000" type="text"/>
                                        </md-input-container>

                                    </td>
                                    <td md-cell class="text-center cell-options" width="120px">

                                        <!--<a ng-click="scope.salvarTaxonomiaCausa(item)">-->
                                        <!--<md-tooltip md-direction="top">-->
                                        <!--Enviar para taxonomia-->
                                        <!--</md-tooltip>-->
                                        <!--<ng-md-icon icon="send"></ng-md-icon>-->
                                        <!--</a>-->

                                        <a ng-show="!item.$update" ng-click="scope.alterarCausa(item)">
                                            <md-tooltip md-direction="top">
                                                Alterar
                                            </md-tooltip>
                                            <ng-md-icon icon="create"></ng-md-icon>
                                        </a>

                                        <a ng-show="!item.$update" ng-click="scope.excluirCausa(item)" class="cursor-pointer">
                                            <md-tooltip md-direction="top">
                                                Excluir
                                            </md-tooltip>
                                            <ng-md-icon icon="delete"></ng-md-icon>
                                        </a>

                                        <md-button ng-show="item.$update" class="md-icon-button" aria-label="Incluir" ng-click="scope.handleCausaChange($event)">
                                            <md-icon class="table-icon">check</md-icon>
                                            <md-tooltip>Alterar Causa de Risco</md-tooltip>
                                        </md-button>

                                        <md-button ng-show="item.$update" class="md-icon-button" aria-label="Cancelar" ng-click="scope.cancelarCausaUpdate()">
                                            <md-icon class="table-icon" md-font-set="material-icons">cancel</md-icon>
                                            <md-tooltip>Cancelar</md-tooltip>
                                        </md-button>

                                    </td>

                                </tr>
                                </tbody>
                            </table>
                        </md-table-container>
                    </md-card>
                </div>

                <div layout="row" layout-xs="column">
                    <h3 style="margin-bottom: 0; padding-left: 7px;">
                        <sgr-glossario termo="Consequências"></sgr-glossario>
                    </h3>
                </div>
                <hr color="#4CAF50" width="99%" size="1px"/>

                <div layout="row" layout-xs="column">
                    <md-button class="md-primary" aria-label="Incluir" ng-click="scope.incluirConsequenciaAndFocus()">
                        <md-icon md-font-set="material-icons">add</md-icon>
                        <sgr-glossario termo="Consequência"></sgr-glossario>
                    </md-button>
                </div>

                <div class="sgr-container-table" layout="column" flex-gt-xs flex="100">
                    <md-card>
                        <md-table-container>
                            <table md-table>
                                <thead md-head>
                                <tr md-row>
                                    <th md-column class="text-center" width="30px">
                                        <sgr-glossario termo="Item"></sgr-glossario>
                                    </th>
                                    <th md-column>
                                        <sgr-glossario termo="Descrição"></sgr-glossario>
                                    </th>
                                    <th md-column class="text-center" width="150px">
                                        <sgr-glossario termo="Ações"></sgr-glossario>
                                    </th>
                                </tr>
                                </thead>

                                <tbody md-body>
                                <tr md-row ng-show="scope.incluirConsequencia">
                                    <td md-cell class="text-center">
                                        <span>#</span>
                                    </td>
                                    <td>

                                        <!--<md-input-container class="md-block" flex-gt-xs flex="100">-->
                                        <!--<label>-->
                                        <!--<sgr-glossario termo="Descrição"></sgr-glossario>-->
                                        <!--</label>-->
                                        <!--<md-autocomplete ng-enter="scope.adicionarConsequencia()" class="md-autocomplete-icon" md-input-id="consequencia-risco" md-floating-label="" md-no-cache="true" md-search-text-change="scope.getConsequenciasBySearch()" md-search-text="scope.consequencia.descricao" md-selected-item-change="scope.consequencia = item" md-item-text="scope.consequencia.descricao" md-items="item in scope._consequencias"-->
                                        <!--md-min-length="2">-->
                                        <!--<md-item-template>-->
                                        <!--<span md-highlight-text="scope.consequencia.descricao" md-highlight-flags="^i">{{item.descricao}}</span>-->
                                        <!--</md-item-template>-->
                                        <!--</md-autocomplete>-->
                                        <!--</md-input-container>-->

                                        <md-input-container class="md-block no-margin" flex-gt-xs flex="100">
                                            <input ng-model="scope.consequencia.descricao" ng-enter="scope.adicionarConsequenciaInline()" max="1000" maxlength="1000" type="text" id="consequencia-risco"/>
                                        </md-input-container>

                                    </td>
                                    <td width="100" align="center" ng-if="!scope.apenasLeitura">
                                        <md-button ng-click="scope.adicionarConsequenciaInline()" class="md-icon-button" aria-label="Editar" style="margin: 0">
                                            <md-icon class="table-icon">check</md-icon>
                                            <md-tooltip>Incluir Consequencia do Risco</md-tooltip>
                                        </md-button>
                                        <md-button ng-click="scope.incluirConsequencia = false; scope.consequencia = {}" class="md-icon-button" aria-label="Excluir" style="margin: 0">
                                            <md-icon class="table-icon" md-font-set="material-icons">cancel</md-icon>
                                            <md-tooltip>Cancelar</md-tooltip>
                                        </md-button>
                                    </td>
                                </tr>

                                <tr md-row ng-repeat="item in scope.registro.consequencias | orderBy: 'consequencia.descricao'">
                                    <td md-cell class="text-center" width="30px">
                                        <span ng-bind="$index + 1"></span>
                                    </td>
                                    <td md-cell>

                                        <span ng-show="!item.$update" ng-bind="item.consequencia.descricao"></span>

                                        <!--<md-input-container ng-show="item.$update" class="md-block" flex-gt-xs flex="100">-->
                                        <!--<label>-->
                                        <!--<sgr-glossario termo="Descrição"></sgr-glossario>-->
                                        <!--</label>-->
                                        <!--<md-autocomplete ng-enter="scope.handleConsequenciaChange($event)" class="md-autocomplete-icon" id="consequencia-risco-editar" md-floating-label="" md-no-cache="true" md-search-text-change="scope.getEditarConsequenciasBySearch()" md-search-text="scope.editarConsequencia.consequencia.descricao"-->
                                        <!--md-selected-item-change="scope.editarConsequencia.consequencia = item"-->
                                        <!--md-item-text="scope.editarConsequencia.consequencia.descricao" md-items="item in scope._consequencias" md-min-length="2">-->
                                        <!--<md-item-template>-->
                                        <!--<span md-highlight-text="scope.editarConsequencia.consequencia.descricao" md-highlight-flags="^i">{{item.descricao}}</span>-->
                                        <!--</md-item-template>-->
                                        <!--</md-autocomplete>-->
                                        <!--</md-input-container>-->

                                        <md-input-container class="md-block no-margin" flex-gt-xs flex="100" ng-show="item.$update">
                                            <input ng-model="scope.editarConsequencia.consequencia.descricao" ng-enter="scope.handleConsequenciaChange($event)" max="1000" maxlength="1000" type="text" id="consequencia-risco-editar"/>
                                        </md-input-container>

                                    </td>
                                    <td md-cell class="text-center cell-options" width="120px">
                                        <!--<a ng-click="scope.salvarTaxonomiaConsequencia(item)">-->
                                        <!--<md-tooltip md-direction="top">-->
                                        <!--Enviar para taxonomia-->
                                        <!--</md-tooltip>-->
                                        <!--<ng-md-icon icon="send"></ng-md-icon>-->
                                        <!--</a>-->

                                        <a ng-show="!item.$update" ng-click="scope.alterarConsequencia(item)">
                                            <md-tooltip md-direction="top">
                                                Alterar
                                            </md-tooltip>
                                            <ng-md-icon icon="create"></ng-md-icon>
                                        </a>

                                        <a ng-show="!item.$update" ng-click="scope.excluirConsequencia(item)" class="cursor-pointer">
                                            <md-tooltip md-direction="top">
                                                Excluir
                                            </md-tooltip>
                                            <ng-md-icon icon="delete"></ng-md-icon>
                                        </a>

                                        <md-button ng-show="item.$update" class="md-icon-button" aria-label="Incluir" ng-click="scope.handleConsequenciaChange($event)">
                                            <md-icon class="table-icon">check</md-icon>
                                            <md-tooltip>Alterar Consequencia do Risco</md-tooltip>
                                        </md-button>

                                        <md-button ng-show="item.$update" class="md-icon-button" aria-label="Cancelar" ng-click="scope.cancelarConsequenciaUpdate()">
                                            <md-icon class="table-icon" md-font-set="material-icons">cancel</md-icon>
                                            <md-tooltip>Cancelar</md-tooltip>
                                        </md-button>

                                    </td>

                                </tr>
                                </tbody>
                            </table>
                        </md-table-container>
                    </md-card>
                </div>

                <div layout="row" layout-xs="column">
                    <h3 style="margin-bottom: 0; padding-left: 7px;">
                        <sgr-glossario termo="Categoria e Natureza"></sgr-glossario>
                    </h3>
                </div>
                <hr color="#4CAF50" width="99%" size="1px"/>

                <div layout="row" layout-xs="column">

                    <md-input-container class="md-block" flex-gt-xs flex="50">
                        <label>
                            <sgr-glossario termo="Categoria do Risco"></sgr-glossario>
                        </label>
                        <md-select ng-model="scope.registro.categoria" required>
                            <md-option ng-value="item" ng-repeat="item in scope._categorias">{{ item.descricao }}</md-option>
                        </md-select>
                    </md-input-container>

                    <md-input-container class="md-block" flex-gt-xs flex="50">
                        <label>
                            <sgr-glossario termo="Natureza do Risco"></sgr-glossario>
                        </label>
                        <input ng-model="scope.registro.categoria.natureza.descricao" type="text" disabled/>
                    </md-input-container>

                </div>

                <div layout="row" layout-xs="column">

                    <md-checkbox class="m-t-15 md-primary" ng-model="scope.registro.riscoIntegridade" aria-label="Evento com risco de integridade associado?">
                        Evento com risco de integridade associado?
                    </md-checkbox>

                </div>

            </div>

            <div class="sgr-container-buttons m-t-10 m-b-10" layout="row" layout-align="end">
                <section layout="row center" layout-sm="column" layout-wrap>
                    <div layout="row" layout-align="space-around center">
                        <md-button class="md-primary" ui-sref="processo.identificacao.alterar({id : scope.processoId})">
                            <md-icon md-font-set="material-icons">close</md-icon>
                            <sgr-glossario termo="Cancelar"></sgr-glossario>
                        </md-button>
                        <md-button class="md-primary md-raised" type="submit">
                            <md-icon md-font-set="material-icons">done</md-icon>
                            <sgr-glossario termo="Salvar"></sgr-glossario>
                        </md-button>
                    </div>
                </section>
            </div>
        </form>
    </div>
</md-content>

