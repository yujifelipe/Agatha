<md-content flex>
    <div class="sgr-container">

        <div class="sgr-container-header" layout="row">
            <div class="md-toolbar-tools">
                <h3 style="font-size: 18px">
                    <sgr-glossario termo="Ações - Acompanhamento"></sgr-glossario>
                </h3>
            </div>
        </div>

        <div class="sgr-container-body">
            <div layout="row" layout-xs="column" class="processo-info p-b-0">
                <div class="md-block" flex-gt-xs flex="100">
                    <strong>
                        <sgr-glossario termo="Macroprocesso"></sgr-glossario>
                    </strong>
                </div>
            </div>
            <div layout="row" layout-xs="column" class="processo-info">
                <div class="md-block" flex-gt-xs flex="100">
                    <span>{{scope._processo.macroprocesso.descricao}}</span>
                </div>
            </div>

            <div layout="row" layout-xs="column" class="processo-info p-b-0">
                <div class="md-block" flex-gt-xs flex="100">
                    <strong>
                        <sgr-glossario termo="Processo"></sgr-glossario>
                    </strong>
                </div>
            </div>
            <div layout="row" layout-xs="column" class="processo-info">
                <div class="md-block" flex-gt-xs flex="100">
                    <span>{{scope._processo.processo}}</span>
                </div>
            </div>

            <div layout="row" layout-xs="column" class="processo-info p-b-0">
                <div class="md-block" flex-gt-xs flex="30">
                    <strong>
                        <sgr-glossario termo="Objetivo do Macroprocesso/Processo"></sgr-glossario>
                    </strong>
                </div>
            </div>
            <div layout="row" layout-xs="column" class="processo-info">
                <div class="md-block" flex-gt-xs flex="30">
                    <span>{{scope._processo.objetivo}}</span>
                </div>
            </div>

            <fieldset class="fieldset-monitoramento m-b-20">

                <div layout="row" layout-xs="column" class="processo-info p-b-0 p-t-0">
                    <div class="md-block" flex-gt-xs flex="20">
                        <strong>
                            <sgr-glossario termo="Evento de Risco"></sgr-glossario>
                        </strong>
                    </div>
                    <div class="md-block text-right" flex-gt-xs flex="80">
                        <span style="color: red" ng-show="scope.exibirAviso">
                            <sgr-glossario termo="Atenção: Ação / Controle com prazo vencido. Inclua um novo acompanhamento e altere, no plano de controle, os prazos previstos."></sgr-glossario>
                        </span>
                    </div>
                </div>
                <div layout="row" layout-xs="column" class="processo-info">
                    <div class="md-block" flex-gt-xs flex="100">
                        <span>{{scope._eventoRisco.evento.descricao}}</span>
                    </div>
                </div>

                <legend class="LegendTamanhoTextoFieldset" style="line-height: 5px">
                    <h3 class="text-center" style="color: #4CAF50">
                        <sgr-glossario termo="Acompanhamentos Realizados"></sgr-glossario>
                    </h3>
                </legend>

                <div layout="row" layout-xs="column" class="processo-info p-b-0">
                    <div class="md-block" flex-gt-xs flex="50">
                        <strong>
                            <sgr-glossario termo="Controle Proposto"></sgr-glossario>
                        </strong>
                    </div>

                    <div class="md-block" flex-gt-xs flex="50">
                        <strong>
                            <sgr-glossario termo="Tipo de Controle"></sgr-glossario>
                        </strong>
                    </div>
                </div>

                <div layout="row" layout-xs="column" class="processo-info">
                    <div class="md-block" flex-gt-xs flex="50">
                        <span>{{scope.planoControle.controle.descricao}}</span>
                    </div>

                    <div class="md-block" flex-gt-xs flex="50">
                        <span>{{scope.planoControle.tipoControle.nome}}</span>
                    </div>
                </div>

                <div layout="row" layout-xs="column" class="processo-info p-b-0">
                    <div class="md-block" flex-gt-xs flex="50">
                        <strong>
                            <sgr-glossario termo="Objetivo do Controle"></sgr-glossario>
                        </strong>
                    </div>

                    <div class="md-block" flex-gt-xs flex="50">
                        <strong>
                            <sgr-glossario termo="Como será implementado"></sgr-glossario>
                        </strong>
                    </div>
                </div>

                <div layout="row" layout-xs="column" class="processo-info">
                    <div class="md-block" flex-gt-xs flex="50">
                        <span>{{scope.planoControle.objetivo.nome}}</span>
                    </div>

                    <div class="md-block" flex-gt-xs flex="50">
                        <span>{{scope.planoControle.implementacao}}</span>
                    </div>
                </div>

                <div layout="row" layout-xs="column" class="processo-info p-b-0">
                    <div class="md-block" flex-gt-xs flex="50">
                        <strong>
                            <sgr-glossario termo="Área Responsável"></sgr-glossario>
                        </strong>
                    </div>

                    <div class="md-block" flex-gt-xs flex="50">
                        <strong>
                            <sgr-glossario termo="Responsável"></sgr-glossario>
                        </strong>
                    </div>
                </div>

                <div layout="row" layout-xs="column" class="processo-info">
                    <div class="md-block" flex-gt-xs flex="50">
                        <span>{{scope.planoControle.areaResponsavel}}</span>
                    </div>

                    <div class="md-block" flex-gt-xs flex="50">
                        <span>{{scope.planoControle.responsavel}}</span>
                    </div>
                </div>

                <div layout="row" layout-xs="column" class="processo-info p-b-0">
                    <div class="md-block" flex-gt-xs flex="50">
                        <strong>
                            <sgr-glossario termo="Data de Início"></sgr-glossario>
                        </strong>
                    </div>

                    <div class="md-block" flex-gt-xs flex="50">
                        <strong>
                            <sgr-glossario termo="Data de Conclusão"></sgr-glossario>
                        </strong>
                    </div>
                </div>

                <div layout="row" layout-xs="column" class="processo-info">
                    <div class="md-block" flex-gt-xs flex="50">
                        <span>{{scope.planoControle.dtInicio | date: 'dd/MM/yyyy'}}</span>
                    </div>

                    <div class="md-block" flex-gt-xs flex="50">
                        <span>{{scope.planoControle.dtConclusao | date: 'dd/MM/yyyy'}}</span>
                    </div>
                </div>

                <div class="sgr-container-table" layout="column">
                    <md-card style="max-height: 300px">
                        <md-table-container>
                            <table md-table>
                                <thead md-head>
                                <tr md-row>
                                    <th md-column class="text-center" width="30px">
                                        <sgr-glossario termo="Item"></sgr-glossario>
                                    </th>
                                    <th md-column width="120px">
                                        <sgr-glossario termo="Status da ação"></sgr-glossario>
                                    </th>
                                    <th md-column width="120px">
                                        <sgr-glossario termo="Controle implementado como planejado?"></sgr-glossario>
                                    </th>
                                    <th md-column>
                                        <sgr-glossario termo="Justificativa/Ações realizadas/Observações"></sgr-glossario>
                                    </th>
                                    <th md-column width="70px">
                                        <sgr-glossario termo="Data da atualização"></sgr-glossario>
                                    </th>
                                    <th md-column class="text-center" width="60px">
                                        <sgr-glossario termo="Ação"></sgr-glossario>
                                    </th>
                                </tr>
                                </thead>

                                <tbody md-body>

                                <tr md-row ng-repeat="item in scope._registros">
                                    <td md-cell class="text-center">
                                        <span>{{$index + 1}}</span>
                                    </td>
                                    <td md-cell>
                                        <span ng-bind="item.status"></span>
                                    </td>
                                    <td md-cell>
                                        <span ng-bind="item.implementado"></span>
                                    </td>
                                    <td md-cell>
                                        <span ng-bind="item.justificativa"></span>
                                    </td>
                                    <td md-cell>
                                        <span ng-bind="item.dtCadastro | date:'dd/MM/yyyy'"></span>
                                    </td>

                                    <td md-cell class="text-center cell-options">
                                        <a class="cursor-pointer no-padding" ng-click="scope.downloadAnexos(item.anexos)" ng-show="item.anexos.length">
                                            <md-tooltip md-direction="top">
                                                Download
                                            </md-tooltip>
                                            <ng-md-icon icon="cloud_download"></ng-md-icon>
                                        </a>
                                        <a ng-click="scope.excluirRegistro(item)" class="cursor-pointer no-padding">
                                            <md-tooltip md-direction="top">
                                                Excluir
                                            </md-tooltip>
                                            <ng-md-icon icon="delete"></ng-md-icon>
                                        </a>
                                    </td>

                                </tr>

                                <tr md-row ng-show="!scope._registros.length">
                                    <td md-cell colspan="100%">
                                        Nenhum registro encontrado
                                    </td>
                                </tr>

                                </tbody>
                            </table>
                        </md-table-container>
                    </md-card>
                </div>


                <div layout="row" layout-xs="column">

                    <div class="md-block" flex-gt-xs flex="50">
                        <div class="sgr-container-buttons" layout="row">
                            <section layout="row center" layout-sm="column" layout-wrap>
                                <md-button class="md-primary" ng-click="scope.novoRegistro(true)">
                                    <md-icon md-font-set="material-icons">add</md-icon>
                                    <sgr-glossario termo="Novo acompanhamento"></sgr-glossario>
                                </md-button>
                            </section>
                        </div>
                    </div>

                    <div class="md-block" flex-gt-xs flex="50">
                        <div class="sgr-container-buttons m-t-10 m-b-10" layout="row" layout-align="end">
                            <section layout="row center" layout-sm="column" layout-wrap>
                                <div layout="row" layout-align="space-around center">
                                    <md-button class="md-primary" ui-sref="processo.planoControle.alterar({id : scope.processoId})">
                                        <md-icon md-font-set="material-icons">close</md-icon>
                                        <sgr-glossario termo="Cancelar"></sgr-glossario>
                                    </md-button>
                                </div>
                            </section>
                        </div>
                    </div>

                </div>

                <div layout="row" layout-xs="column" class="processo-info">
                    <div class="md-block" flex-gt-xs flex="20"></div>

                    <div class="md-block text-center" flex-gt-xs flex="60">

                        <a class="link-acompanhamento" ng-click="scope.voltarPlano()" ng-class="scope.planoControle.index == 0 ? 'link-acompanhamento-disabled' : ''">
                            &#60;&#60; Anterior
                        </a>

                        <span>
                            {{scope.planoControle.index + 1}}
                        </span>

                        <a class="link-acompanhamento" ng-click="scope.avancarPlano()" ng-class="(scope.planoControle.index + 1) >= scope._eventoRisco.controles.length ? 'link-acompanhamento-disabled' : ''">
                            Próximo &#62;&#62;
                        </a>

                    </div>

                    <div class="md-block text-right" flex-gt-xs flex="20">
                        <span>
                            {{scope.planoControle.index + 1}} de {{scope._eventoRisco.controles.length}} Registros
                        </span>
                    </div>
                </div>

            </fieldset>

            <fieldset class="fieldset-monitoramento m-b-20" ng-show="scope.incluirRegistro">

                <legend class="LegendTamanhoTextoFieldset" style="line-height: 5px">
                    <h3 class="text-center" style="color: #4CAF50">
                        <sgr-glossario termo="Incluir Acompanhamento"></sgr-glossario>
                    </h3>
                </legend>

                <form name="formRegistro" ng-submit="scope.persistir(scope.registro)" novalidate>

                    <div layout="row" layout-xs="column">

                        <div class="md-block" flex-gt-xs flex="30" style="padding-right: 15px">

                            <div layout="row" layout-xs="column">

                                <md-input-container class="md-block" flex-gt-xs flex="100">
                                    <label>
                                        <sgr-glossario termo="Status do plano de ação"></sgr-glossario>
                                    </label>
                                    <md-select name="status" ng-model="scope.registro.status" placeholder="Status do plano de ação" required>
                                        <md-option ng-repeat="item in scope._status" ng-value="item">
                                            {{item}}
                                        </md-option>
                                    </md-select>
                                </md-input-container>

                            </div>

                            <div layout="row" layout-xs="column">

                                <md-input-container class="md-block" flex-gt-xs flex="100" style="margin-top: 27px">
                                    <label>
                                        <sgr-glossario termo="Controle implementado como planejado?"></sgr-glossario>
                                    </label>
                                    <md-select name="implementado" ng-model="scope.registro.implementado" placeholder="Controle implementado como planejado?" required>
                                        <md-option ng-repeat="item in scope._implementacoes" ng-value="item">
                                            {{item}}
                                        </md-option>
                                    </md-select>
                                </md-input-container>

                            </div>

                        </div>

                        <div class="md-block" flex-gt-xs flex="70" style="padding-left: 15px">

                            <div layout="row" layout-xs="column">

                                <md-input-container class="md-block" flex-gt-xs flex="100">
                                    <label>Justificativas/Ações realizadas/Observações</label>
                                    <textarea class="sgr-textarea" style="min-height: 112px !important;" name="justificativa" ng-model="scope.registro.justificativa" maxlength="500" md-maxlength="500" md-select-on-focus
                                              placeholder="Use esse espaço para detalhar ou justificar atrasos, mudanças nas ações previstas ou demais observações relevantes para o processo" required></textarea>
                                </md-input-container>

                            </div>

                        </div>

                    </div>

                    <div layout="row" layout-xs="column">

                        <md-content class="md-block acompanhamento-upload" flex-gt-xs flex="100">

                            <lf-ng-md-file-input name="files" lf-api="scope.uploadApi" lf-files="scope.files" lf-totalsize="25MB" lf-mimetype="" aria-label="Envio de arquivos" lf-remove-label="Excluir" lf-browse-label="Incluir Anexos" lf-placeholder="Procurar" multiple></lf-ng-md-file-input>

                            <div ng-messages="formRegistro.files.$error" style="color:red;">
                                <div ng-if="formRegistro.$error.totalsize.length > 0">
                                    O tamanho máximo é de 25MB.
                                </div>
                            </div>
                        </md-content>
                    </div>

                    <div layout="row" layout-xs="column" ng-show="scope.registro.anexos.length">
                        <div class="sgr-container-table" layout="column" flex-gt-xs flex="100">
                            <md-card>
                                <md-table-container>
                                    <table md-table>
                                        <thead md-head>
                                        <tr md-row>
                                            <th md-column class="text-center" width="30px">
                                                <sgr-glossario termo="Item"></sgr-glossario>
                                            </th>
                                            <th md-column>
                                                <sgr-glossario termo="Nome do Anexo"></sgr-glossario>
                                            </th>
                                            <th md-column width="80px">
                                                <sgr-glossario termo="Tamanho"></sgr-glossario>
                                            </th>
                                            <th md-column class="text-center" width="60px">
                                                <sgr-glossario termo="Ações"></sgr-glossario>
                                            </th>
                                        </tr>
                                        </thead>

                                        <tbody md-body>
                                        <tr md-row ng-repeat="item in scope.registro.anexos">
                                            <td md-cell class="text-center">
                                                <span>{{$index + 1}}</span>
                                            </td>
                                            <td md-cell>
                                                <span>{{item.nomeArquivo}}</span>
                                            </td>
                                            <td md-cell>
                                                <span>{{item.tamanho/1024/1024|number:2}} MB</span>
                                            </td>

                                            <td md-cell class="text-center">
                                                <a ng-href="{{'/gestaoriscos/api/processos/download/' + item.id}}" class="cursor-pointer no-padding">
                                                    <md-tooltip md-direction="top">
                                                        Visualizar
                                                    </md-tooltip>
                                                    <ng-md-icon class="table-button-icon" icon="remove_red_eye"></ng-md-icon>
                                                </a>

                                                <a aria-label="Remover" ng-click="scope.excluirAnexo($index)" class="cursor-pointer no-padding">
                                                    <md-tooltip md-direction="top">
                                                        Remover anexo
                                                    </md-tooltip>
                                                    <ng-md-icon class="table-button-icon" icon="delete"></ng-md-icon>
                                                </a>
                                            </td>

                                        </tr>
                                        </tbody>
                                    </table>
                                </md-table-container>
                            </md-card>
                        </div>
                    </div>

                    <div class="sgr-container-buttons sgr-container-footer" layout="row" layout-align="end">
                        <section layout="row center" layout-sm="column" layout-wrap>
                            <div layout="row" layout-align="space-around center">
                                <md-button class="md-primary md-raised" type="submit">
                                    <md-icon md-font-set="material-icons">done</md-icon>
                                    <sgr-glossario termo="Salvar"></sgr-glossario>
                                </md-button>
                            </div>
                        </section>
                    </div>

                </form>

            </fieldset>

        </div>

    </div>
</md-content>

